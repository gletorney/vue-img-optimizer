/*!
 * Image Compressor v0.5.2
 * https://github.com/xkeshi/image-compressor
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.ImageCompressor=t()}(this,function(){"use strict";var e,t=(function(e){var t,n,r,o,a,i,u;t=window,n=t.HTMLCanvasElement&&t.HTMLCanvasElement.prototype,r=t.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),o=r&&t.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),a=t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||t.MSBlobBuilder,i=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,u=(r||a)&&t.atob&&t.ArrayBuffer&&t.Uint8Array&&function(e){var t,n,u,l,s,c,f,h,m;if(!(t=e.match(i)))throw new Error("invalid data URI");for(n=t[2]?t[1]:"text/plain"+(t[3]||";charset=US-ASCII"),u=!!t[4],l=e.slice(t[0].length),s=u?atob(l):decodeURIComponent(l),c=new ArrayBuffer(s.length),f=new Uint8Array(c),h=0;h<s.length;h+=1)f[h]=s.charCodeAt(h);return r?new Blob([o?f:c],{type:n}):((m=new a).append(c),m.getBlob(n))},t.HTMLCanvasElement&&!n.toBlob&&(n.mozGetAsFile?n.toBlob=function(e,t,r){var o=this;setTimeout(function(){r&&n.toDataURL&&u?e(u(o.toDataURL(t,r))):e(o.mozGetAsFile("blob",t))})}:n.toDataURL&&u&&(n.toBlob=function(e,t,n){var r=this;setTimeout(function(){e(u(r.toDataURL(t,n)))})})),e.exports?e.exports=u:t.dataURLtoBlob=u}(e={exports:{}},e.exports),e.exports),n=Object.prototype.toString,r={checkOrientation:!0,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,quality:.8,mimeType:"auto",convertSize:5e6,success:null,error:null},o=/^image\/.+$/;function a(e){return o.test(e)}var i=String.fromCharCode;var u=window.btoa;function l(e){var t=new DataView(e),n=void 0,r=void 0,o=void 0,a=void 0;if(255===t.getUint8(0)&&216===t.getUint8(1))for(var u=t.byteLength,l=2;l<u;){if(255===t.getUint8(l)&&225===t.getUint8(l+1)){o=l;break}l+=1}if(o){var s=o+10;if("Exif"===function(e,t,n){var r="",o=void 0;for(n+=t,o=t;o<n;o+=1)r+=i(e.getUint8(o));return r}(t,o+4,4)){var c=t.getUint16(s);if(((r=18761===c)||19789===c)&&42===t.getUint16(s+2,r)){var f=t.getUint32(s+4,r);f>=8&&(a=s+f)}}}if(a){var h=t.getUint16(a,r),m=void 0,d=void 0;for(d=0;d<h;d+=1)if(m=a+12*d+2,274===t.getUint16(m,r)){m+=8,n=t.getUint16(m,r),t.setUint16(m,1,r);break}}return n}!function(){function e(e){this.value=e}function t(t){var n,r;function o(n,r){try{var i=t[n](r),u=i.value;u instanceof e?Promise.resolve(u.value).then(function(e){o("next",e)},function(e){o("throw",e)}):a(i.done?"return":"normal",i.value)}catch(e){a("throw",e)}}function a(e,t){switch(e){case"return":n.resolve({value:t,done:!0});break;case"throw":n.reject(t);break;default:n.resolve({value:t,done:!1})}(n=n.next)?o(n.key,n.arg):r=null}this._invoke=function(e,t){return new Promise(function(a,i){var u={key:e,arg:t,resolve:a,reject:i,next:null};r?r=r.next=u:(n=r=u,o(e,t))})},"function"!=typeof t.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)}}();var s=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},h=window,m=h.ArrayBuffer,d=h.FileReader,v=window.URL||window.webkitURL,p=/\.\w+$/;return function(){function e(t,n){s(this,e),this.result=null,t&&this.compress(t,n)}return c(e,[{key:"compress",value:function(e,o){var s=this,c=new Image;return o=f({},r,o),m||(o.checkOrientation=!1),new Promise(function(t,r){if((s=e)instanceof Blob||"[object Blob]"===n.call(s)){var s,c=e.type;if(a(c))if(v||d){if(v&&!o.checkOrientation)t(v.createObjectURL(e));else if(d){var h=new d,m=o.checkOrientation&&"image/jpeg"===c;h.onload=function(e){var n=e.target.result;t(m?f({url:function(e,t){var n=new Uint8Array(e),r=n.length,o="",a=void 0;for(a=0;a<r;a+=1)o+=i(n[a]);return"data:"+t+";base64,"+u(o)}(n,c)},function(e){var t=0,n=1,r=1;switch(e){case 2:n=-1;break;case 3:t=-180;break;case 4:r=-1;break;case 5:t=90,r=-1;break;case 6:t=90;break;case 7:t=90,n=-1;break;case 8:t=-90}return{rotate:t,scaleX:n,scaleY:r}}(l(n))):{url:n})},h.onabort=r,h.onerror=r,m?h.readAsArrayBuffer(e):h.readAsDataURL(e)}}else r(new Error("Oh snap. This browser is not supported. Please upgrade and/or use Chrome."));else r(new Error("Umm. Image files only!"))}else r(new Error("Umm. Image files only!"))}).then(function(t){return new Promise(function(n,r){c.onload=function(){return n(f({},t,{naturalWidth:c.naturalWidth,naturalHeight:c.naturalHeight}))},c.onabort=r,c.onerror=r,c.alt=e.name,c.src=t.url})}).then(function(n){var r=n.naturalWidth,i=n.naturalHeight,u=n.rotate,l=void 0===u?0:u,s=n.scaleX,f=void 0===s?1:s,h=n.scaleY,m=void 0===h?1:h;return new Promise(function(n){var u=document.createElement("canvas"),s=u.getContext("2d"),h=r/i,d=Math.max(o.maxWidth,0)||1/0,v=Math.max(o.maxHeight,0)||1/0,p=Math.max(o.minWidth,0)||0,g=Math.max(o.minHeight,0)||0,b=r,w=i;if(d<1/0&&v<1/0?v*h>d?v=d/h:d=v*h:d<1/0?v=d/h:v<1/0&&(d=v*h),p>0&&g>0?g*h>p?g=p/h:p=g*h:p>0?g=p/h:g>0&&(p=g*h),o.width>0)w=(b=o.width)/h;else if(o.height>0){b=(w=o.height)*h}var y=-(b=Math.min(Math.max(b,p),d))/2,U=-(w=Math.min(Math.max(w,g),v))/2,x=b,B=w;if(Math.abs(l)%180==90){var k={width:w,height:b};b=k.width,w=k.height}u.width=b,u.height=w,s.fillStyle="transparent",s.fillRect(0,0,b,w),s.save(),s.translate(b/2,w/2),s.rotate(l*Math.PI/180),s.scale(f,m),s.drawImage(c,Math.floor(y),Math.floor(U),Math.floor(x),Math.floor(B)),s.restore(),a(o.mimeType)||(o.mimeType=e.type),e.size>o.convertSize&&"image/png"===o.mimeType&&(o.mimeType="image/jpeg"),u.toBlob?u.toBlob(n,o.mimeType,o.quality):n(t(u.toDataURL(o.mimeType,o.quality)))})}).then(function(t){if(v&&v.revokeObjectURL(c.src),t)if(t.size>e.size&&!(o.width>0||o.height>0||o.maxWidth<1/0||o.maxHeight<1/0||o.minWidth>0||o.minHeight>0))t=e;else{var n=new Date;t.lastModified=n.getTime(),t.lastModifiedDate=n,t.name="compressed_"+e.name,t.name&&t.type!==e.type&&(t.name=t.name.replace(p,function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=a(e)?e.substr(6):"";return"jpeg"===n&&(n="jpg"),n&&t&&(n="."+n),n}(t.type)))}else t=e;return s.result=t,o.success&&(o.success(t),$(".download-button.half-fade").addClass("show")),Promise.resolve(t)}).catch(function(e){if(!o.error)throw e;o.error(e)})}}]),e}()});